## 도커

도커는 컨테이너형 가상화 기술을 구현하기 위한 상주 어플리케이션과 이 어플리케이션을 조작하기 위한 명령행 도구로 구성되는 프로덕트이다

어플리케이션 개발 및 운영을 컨테이너 중심으로 할 수 있다

몇 줄짜리 구성파일(Dockerfile)과 명령어 한 줄로 어플리케이션, 미들웨어가 이미 갖춰진 테스트용 가상환경(도커 컨테이너)를 빠르게 구축할 수 있다

**뛰어난 이식성** : 개발환경과 운영환경의 동등 재현 가능



**컨테이너 가상화 기술**

가상화 소프트웨어 없이 운영체제의 리소스를 격리해 가상 운영 체제로 만들 수 있다

호스트 운영체제는 구조적으로 오버헤드가 크가

![도커 컨테이너와 가상머신의 차이](images/img.png)





### 도커 맛보기

```sh
#!/bin/sh

echo "hello, world!"
```

Docker Image Build : 도커파일이나 어플리케이션 실행파일을 사용하여 도커 컨테이너의 원형 이미지 만드는 과정

FROM : 운영체제를 정의

COPY : 바로 위의 셸 스크립트 파일을 도커 컨테이너 안의 /usr/local/bin에 복사

RUN : 도커 컨테이너 안의 어떤 명령을 수행 -> 실행권한 부여하는 예제

CMD : 완성된 이미지를 도커 컨테이너로 실행전에 먼저 실행할 명령 정의 -> 어플리케이션 실행 예제

```docker
FROM ubuntu:16.04

COPY helloworld /usr/local/bin
RUN chmod +x /usr/local/bin/helloworld

CMD ["helloworld"]
```



`docker image bulid -t helloworld:latest` : 이미지를 빌드하고 실행

`docker container run helloworld:latest` :빌드후 컨테이너를 실행

-> 우분투 운영체제와 함께 컨테이너로 실행





### CMD vs Entrypoint

두가지의 명령 모두 이미지를 바탕으로 생성된 컨테이너에서 사용



`CMD`는 `docker run` 실행 시 **명령어를 주지 않았을 때 사용할 default 명령을 설정**하거나, `ENTRYPOINT`의 **default 파라미터를 설정할 때 사용**한다. `CMD` 명령의 주용도는 컨테이너를 실행할 때 사용할 **default를 설정**하는 것이다. `CMD` 명령은 3가지 형태가 있다.

- CMD [“executable”,”param1”,”param2”] (exec form, this is the preferred form)
- CMD [“param1”,”param2”] (as default parameters to ENTRYPOINT)
- CMD command param1 param2 (shell form)

```
FROM ubuntu
CMD echo "This is a test."
```

위와 같이 Dockerfile을 만들었을 때, `docker run` 실행 시 아무런 커맨드를 주지 않으면 `CMD` 명령이 실행된다.

```
$ docker run -it --rm <image-name>
This is a test
$
```

하지만, `echo "Hello"` 라고 실행할 커맨드를 주게 되면 `CMD`는 무시되고 커맨드가 실행된다.

```
$ docker run -it --rm <image-name> echo "Hello"
Hello
$
```

`CMD`는 여러번 사용할 수 있지만 가장 마지막에 있는 `CMD` 딱 1개만 남게 된다





`ENTRYPOINT`는 2가지 형태를 가지고 있다.

- ENTRYPOINT [“executable”, “param1”, “param2”] (exec form, preferred)
- ENTRYPOINT command param1 param2 (shell form)

`docker run` 실행 시 실행되는 명령이라고 생각해도 좋을 것 같다

**특정루틴의 고정실행에 좋다**

```
FROM ubuntu
ENTRYPOINT ["/bin/echo", "Hello"]
CMD ["world"]
```

위 Dockerfile의 내용을 실행하면 `CMD`에서 설정한 default 파라미터가 `ENTRYPOINT`에서 사용된다. `docker run` 명령 실행 시 파라미터를 주면 `CMD`에서 설정한 파라미터는 사용되지 않는다.

```
$ docker run -it --rm <image-name>
Hello world
$ docker run -it --rm <image-name> ME
Hello ME
$
```

shell form 으로 실행해야만 변수 등이 대체(substitution)된다.

```
FROM ubuntu
ENTRYPOINT [ "echo", "$HOME" ]
$ docker run -it --rm <image-name>
$HOME
$
```

위처럼 exec form으로 사용하면 `$HOME` 이 그대로 사용되고, 아래처럼 shell form으로 사용하면 변수 등이 변환된다.

```
FROM ubuntu
ENTRYPOINT echo $HOME
$ docker run -it --rm <image-name>
/root
$
```





