## 쿠버네티스

2017년 도커에 통합되면서 컨테이너 오케스트레이션 도구의 표준 지위를 확보

도커 스웜과 비슷한 역할을 하지만 기능이 더 풍부하고 주변 생태계도 잘 갖춰져 있다





**오케스트레이션 툴**이란 여러 호스트 서버의 컨테이너들을 배포, 관리하기위한 툴을 일컷는 말이다.

오케스트레이션 툴은 배포뿐 아니라

- 컨테이너 자동 배치, 복제

- 컨테이너 그룹에 대한 로드 밸런싱

- 컨테이너 장애 복구

- 클러스터 외부에 서비스 노출
  - 클러스터는 manage-node와 worker-node가 필요하다

  - manage -> worker -> service 순으로 관리

  - 클러스터는 worker node를 묶어 서비스를 제공한다

  - 동작원리 : Web 서비스를 예를 들면 한개의 도메인에 cluster로 묶인 서버(worker-node)를 사용하여 서비스를 제공할 경우 사용자는 매번 해당 도메인에 접속시 cluster로 묶인 서버(worker-node) 중 한대를 접속 할 수 있게 됩니다.

    





## Probe types

Liveness probe와 readiness probe는 컨테이너가 정상적인지 아닌지를 체크하는 방법으로 다음과 같이 3가지 방식을 제공한다.

- Command probe
- HTTP probe
- TCP probe

## Liveness Probe

Liveness probe는 컨테이너의 상태를 주기적으로 체크해서, 응답이 없으면 컨테이너를 자동으로 재시작해준다. 컨테이너가 정상적으로 기동중인지를 체크하는 기능이다.



Liveness probe는 Pod의 상태를 체크하다가, Pod의 상태가 비정상인 경우 kubelet을 통해서 재 시작한다.

![img](images/99621F3D5B2FA1AE1D)

## Readiness probe

컨테이너의 상태 체크중에 liveness의 경우에는 컨테이너가 비정상적으로 작동이 불가능한 경우도 있지만, Configuration을 로딩하거나, 많은 데이타를 로딩하거나, 외부 서비스를 호출하는 경우에는 일시적으로 서비스가 불가능한 상태가 될 수 있다. 이런 경우에는 컨테이너를 재시작한다 하더라도 정상적으로 서비스가 불가능할 수 있다. 이런 경우에는 컨테이너를 일시적으로 서비스가 불가능한 상태로 마킹해주면 되는데, 이러한 기능은 쿠버네티스의 서비스와 함께 사용하면 유용하게 이용할 수 있다. 



예를 들어 쿠버네티스 서비스에서 아래와 같이 3개의 Pod를 로드밸런싱으로 서비스를 하고 있을때, Readiness probe 를 이용해서 서비스 가능 여부를 주기적으로 체크한다고 하자. 이 경우 하나의 Pod가 서비스가 불가능한 상태가 되었을때, 즉 Readiness Probe에 대해서 응답이 없거나 실패 응답을 보냈을때는 해당 Pod를 사용 불가능한 상태로 체크하고 서비스 목록에서 제외한다. 

![img](images/991653345B2FA1AE11)





Liveness probe와 차이점은 Liveness probe는 컨테이너의 상태가 비정상이라고 판단하면, 해당 Pod를 재시작하는데 반해, Readiness probe는 컨테이너가 비정상일 경우에는 해당 Pod를 사용할 수 없음으로 표시하고, 서비스등에서 제외한다. 

